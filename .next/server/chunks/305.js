"use strict";exports.id=305,exports.ids=[305],exports.modules={1305:(e,t,i)=>{i.r(t),i.d(t,{createOrReadKeyless:()=>createOrReadKeyless,removeKeyless:()=>removeKeyless,safeParseClerkFile:()=>safeParseClerkFile});var r=i(7274),l=i(851);let n=".clerk",s="clerk.lock",generatePath=(...e)=>{let t=(0,l.t$)(),i=(0,l.t0)();return t.join(i(),n,...e)},a=".tmp",getKeylessConfigurationPath=()=>generatePath(a,"keyless.json"),getKeylessReadMePath=()=>generatePath(a,"README.md"),c=!1;function safeParseClerkFile(){let{readFileSync:e}=(0,l.ur)();try{let t;let i=getKeylessConfigurationPath();try{t=e(i,{encoding:"utf-8"})||"{}"}catch{t="{}"}return JSON.parse(t)}catch{return}}let lockFileWriting=()=>{let{writeFileSync:e}=(0,l.ur)();c=!0,e(s,"This file can be deleted. Please delete this file and refresh your application",{encoding:"utf8",mode:"0777",flag:"w"})},unlockFileWriting=()=>{let{rmSync:e}=(0,l.ur)();try{e(s,{force:!0,recursive:!0})}catch{}c=!1},isFileWritingLocked=()=>{let{existsSync:e}=(0,l.ur)();return c||e(s)};async function createOrReadKeyless(){let{writeFileSync:e,mkdirSync:t}=(0,l.ur)();if(isFileWritingLocked())return null;lockFileWriting();let i=getKeylessConfigurationPath(),s=getKeylessReadMePath();t(generatePath(a),{recursive:!0}),function(){let{existsSync:e,writeFileSync:t,readFileSync:i,appendFileSync:r}=(0,l.ur)(),s=(0,l.t$)(),a=(0,l.t0)(),c=s.join(a(),".gitignore");e(c)||t(c,"");let o=i(c,"utf-8");o.includes(n+"/")||r(c,`
# clerk configuration (can include secrets)
/${n}/
`)}();let c=safeParseClerkFile();if((null==c?void 0:c.publishableKey)&&(null==c?void 0:c.secretKey))return unlockFileWriting(),c;let o=(0,r.f)({}),u=await o.__experimental_accountlessApplications.createAccountlessApplication().catch(()=>null);if(u){e(i,JSON.stringify(u),{encoding:"utf8",mode:"0777",flag:"w"});let t=`
## DO NOT COMMIT
This directory is auto-generated from \`@clerk/nextjs\` because you are running in Keyless mode. Avoid committing the \`.clerk/\` directory as it includes the secret key of the unclaimed instance.
  `;e(s,t,{encoding:"utf8",mode:"0777",flag:"w"})}return unlockFileWriting(),u}function removeKeyless(){let{rmSync:e}=(0,l.ur)();if(!isFileWritingLocked()){lockFileWriting();try{e(generatePath(),{force:!0,recursive:!0})}catch{}unlockFileWriting()}}}};